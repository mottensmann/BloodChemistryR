---
title: "R-code for 'TITLE OF THE PAPER'"
author: "Meinolf Ottensmann & Tony Rinaud"
output: html_document
header-includes:
- \usepackage{pdflscape}
- \newcommand{\blandscape}{\begin{landscape}}
- \newcommand{\elandscape}{\end{landscape}}
---

```{r setup, include=FALSE, fig.align='center', tidy=TRUE, strip.white=TRUE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


*In preparation*

This document provides all the `R code` to reproduce results presented in our paper. Both the Rmarkdown file and the data can be downloaded from the accompanying GitHub repository on (https://github.com/mottensmann/BloodChemistryR) as a zip archive containing all the files. We recommend to download or clone this [GitHub repository](https://github.com/mottensmann/BloodChemistryR) in order to access the documentation together with all the files that are needed to repeat analyses shown in this document. Just click on the link above and then on the green box `Clone or download`. In order to function properly, the same structure of folders must be kept. If you have any questions, don't hesitate to contact meinolf.ottensmann[at]web.de

In order to repeat analyses presented in this manuscript a number of packages that extend the functionalities of base `R` are required. These can be installed using the code shown below.

```{r install, comment="install packages", eval=FALSE}
## not run!
install.packages("ade4")
install.packages("chron")
install.packages("cowplot")
install.packages("devtools")
install.packages("factoextra")
install.packages("FactoMineR")
install.packages("EnvStats")
install.packages("ggcorrplot")
install.packages("ggrepel")
install.packages("ggsci")
install.packages(Hmisc)
install.packages(heplots)
install.packages("magrittr")
install.packages("MASS")
install.packages("patchwork")
install.packages("RColorBrewer")
install.packages("readxl")
install.packages("reshape2")
install.packages("RVAideMemoire")
install.packages("sjPlot")
install.packages("tidyverse")
install.packages("vegan")
```

Afterwards, make these packages available with the `library` function

```{r, comment="Load packages", message=FALSE, warning=FALSE}
library(ade4)
library(chron)
library(corrplot)
library(cowplot)
library(factoextra)
library(FactoMineR)
library(EnvStats)
library(ggcorrplot)
library(ggeffects)
library(ggrepel)
library(ggsci)
library(Hmisc)
library(heplots)
library(magrittr)
library(MASS)
library(patchwork)
library(RColorBrewer)
library(readxl)
library(reshape2)
library(RVAideMemoire)
library(sjPlot)
library(tidyverse)
library(vegan)
```

### Raw data

Raw data are provided in one single file that is read into the working memory using the following command

```{r read table, message=FALSE, warning=FALSE}
## read data
data <- readxl::read_xlsx("data/raw.xlsx") %>% as.data.frame()
```

For the analyses some data wrangling is needed first. Prior to analysis, all continuous variables are standardised using a z-transformation to improve model convergence as well as the interpretation of model estimates (e.g. Schielzeth 2010).

```{r}
data <- 
  mutate(data,
         Species = factor(Species, levels = c("Buteo buteo", "Milvus milvus", "Accipiter gentilis"))) %>% 
  ## code prevelance as binomial factor, with infected = 1
  mutate(Infection_binomial = ifelse(Infection_intensity == 0, 0, 1) %>%
                 as.factor()) %>% 
  ## code infection intensity as factor with 3 levels
  mutate(Infectionclass = case_when(
  Infection_intensity == 0 ~ "Uninfected",
  Infection_intensity %in% 1:2 ~ "Infected (low)",
  Infection_intensity %in% 3:4 ~ "Infected (high)",
  TRUE ~ as.character(Infection_intensity))
   %>% 
  as.factor()) %>% 
  ## add a grouping variable for the variable age
  mutate(AgeClass = case_when(
    Age <= 25 ~ "Three weeks",
    Age > 25 & Age < 30 ~ "A month",
    Age > 30 ~ "Over a month"
  ) %>% 
  as.factor()) %>% 
  mutate(AgeClass2 = case_when(
    Age_standardised <= 0.33 ~ "1/3",
    Age_standardised > 0.33 & Age_standardised < 0.66 ~ "2/3",
    Age_standardised > 0.66 ~ "3/3"
  )) %>% 
  ## z-transform standardised ages
  mutate(Age = scale(data$Age_standardised) %>% 
  as.numeric())
```


### Analyses

Two variables, `GLDH` and `Basophiles_percent` are essentially uniform, and values are identical for all individuals of some groups (e.g. Species X Infection level). Hence, these variables are omitted from PCA and LDA models. 

#### A.) PCA

First, we use a principal component analysis as unsupervised clustering approach to distinguish between infection intensity levels. 

```{r}
## Subset the raw data for PCA
pca.dat <- 
  data[,
       c("Leukocyte_count", "Lymphocytes_percent", "Monocytes_percent",
         "Heterophiles_percent",
         "H_L_ratio", "Eosinophiles_percent", "AP", "AST",
         "gGT", "CHE", "BA", "LDH", "CK", "ALB",  "TP")] %>% 
  ## mean centering of variables
  scale() %>% 
  na.omit()
```

##### Visualising correlation matrix to check for collinearity issues

```{r, fig.cap="Fig 1. Correlation matrix of numeric variables. Insignifcant correlation (p > 0.05) are crossed."}
ggcorrplot(cor(pca.dat), p.mat = cor_pmat(pca.dat), hc.order=TRUE, type='lower')
```

The above plot (Fig 1) shows that there are a few issues regarding collinear variables. For the the ratio between Heterocytes and Lymphocytes this is most evident (and expected).

```{r, fig.cap="Fig 2. Loading of variables on PCA axes 1 and 2"}
## Defining function for circular plots
circleFun <- function(center = c(0,0),diameter = 1, npoints = 100){
  r = diameter / 2
  tt <- seq(0,2*pi,length.out = npoints)
  xx <- center[1] + r * cos(tt)
  yy <- center[2] + r * sin(tt)
  return(data.frame(x = xx, y = yy))
}

circ <- circleFun(c(0,0),2,npoints = 500)

## Conduct PCA
## PCA  (cf https://tem11010.github.io/Plotting-PCAs/)
pca <- PCA(pca.dat, graph = F)

## Extract PCÂ´s and reformat
pca.coords <- data.frame(pc1 = unlist(pca$ind$coord[, 1], recursive = T,use.names = T), 
                         pc2 = unlist(pca$ind$coord[, 2], recursive = T,use.names = T))

pca.vars <- pca$var$coord %>% data.frame
pca.vars$vars <- rownames(pca.vars)
pca.vars.m <- melt(pca.vars, id.vars = "vars")

## Plot PCA variables correlation
vars.p <-  ggplot() +
  geom_path(data = circ,aes(x,y), lty = 2, color = "grey", alpha = 0.7)+
  geom_hline(yintercept = 0, lty = 2, color = "grey", alpha = 0.9)+
  geom_vline(xintercept = 0, lty = 2, color = "grey", alpha = 0.9)+
  geom_segment(data = pca.vars,
               aes(x = 0, xend = Dim.1, y = 0, yend = Dim.2,
                   alpha = .6),
               arrow = arrow(length = unit(0.025, "npc"), type = "open"), 
               lwd = 1)+ 
  geom_text_repel(data = pca.vars, 
                  aes(x = Dim.1*1.15, y =  Dim.2*1.15, 
                      label = row.names(pca.vars),
                      alpha = .6), 
                  color = "blue",
                  size = 5)+
  xlab(paste0("PC 1 (", round(pca$eig[1,2],2),"%)"))+ 
  ylab(paste0("PC 2 (", round(pca$eig[2,2],2),"%)"))+
  coord_equal()+
  theme_minimal()+
  theme(panel.grid = element_blank(), 
        panel.border = element_rect(fill= "transparent"))

vars.p
```

##### Plot PCA results grouped by secies

Visualising the PCA with species as a grouping variable shows considerable overlap, especially between *Buteo buteo* and *Milvus milvus*.


```{r, fig.cap="Fig 3. PCA using species as grouping factor"}
spec.plot <- 
  ggplot(pca.coords, aes(x = pc1, y = pc2, color = data$Species)) +
  geom_point(color = 'black', size = 4.5) +
  geom_point(size = 4) +
  labs(color = "Species") +
  xlab(paste0("PC 1 (", round(pca$eig[1,2],2),"%)"))+ 
  ylab(paste0("PC 2 (", round(pca$eig[2,2],2),"%)"))+
  geom_hline(yintercept = 0, lty = 2) +
  geom_vline(xintercept = 0, lty = 2) +
  scale_color_manual(values=c("#427EF6", "#7C3918", "#FF9100")) +
  scale_fill_manual(values=c("#427EF6", "#7C3918", "#FF9100")) +
  theme_classic()+
  theme(legend.position = "bottom",
        legend.text = element_text(size = 12),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 12),
        plot.title = element_text(hjust = 0.5, face = "bold"),
        panel.border = element_rect(fill = "transparent")) +
    stat_ellipse(geom = "polygon", aes(fill = data$Species),
                 alpha = 0.2, show.legend = FALSE, level = 0.95)
spec.plot
```

##### Plot PCA results grouped by infection intensity 

Plotting PCA results grouped by infection intenstiy pooled for all three species shows considerable overlap between groups. 

```{r, fig.cap="Fig 4. PCA using infection intensity as grouping factor"}
inf.plot <- ggplot(data = pca.coords, 
                     aes(x = pc1, y = pc2, color = as.factor(data$Infectionclass))) +
  geom_point(color='black',size=4.5) +
  geom_point(size = 4) +
  xlab(paste0("PC 1 (", round(pca$eig[1,2],2),"%)"))+ 
  ylab(paste0("PC 2 (", round(pca$eig[2,2],2),"%)"))+
  labs(color = "Infection intensity") +
  geom_hline(yintercept = 0, lty = 2) +
  geom_vline(xintercept = 0, lty = 2) +
  scale_color_manual(values = c("#A50F15","#FB6A4A","#FCAE91")) +
  scale_fill_manual(values = c("#A50F15","#FB6A4A","#FCAE91")) +
#  scale_fill_manual(values=c("#427EF6", "#7C3918", "#FF9100")) +
  theme_classic() +
  theme(legend.position = "bottom",
        legend.text = element_text(size = 12),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 12), 
        plot.title = element_text(hjust = 0.5, face="bold"),
        panel.border = element_rect(fill= "transparent")) +
  stat_ellipse(geom ="polygon", aes(color = as.factor(data$Infectionclass)), 
               alpha = 0.05, show.legend = FALSE, level = 0.95, size=0.7)

inf.plot
#spec.plot/inf.plot|vars.p + plot_layout(ncol = 1)
```


#### B.) LDA

Linear discriminant analysis as supervised clustering method.

```{r, fig.cap="Fig 5. Q-Q plots of all numeric variables"}
# Checking normal multivariate distribution
par(mfrow = c(3, 5))
for(i in dimnames(pca.dat)[[2]]) {
  qqnorm(pca.dat[,i]); qqline(pca.dat[,i], col = 3)
}
```


```{r, warning=F, message=F}
# Checking homogeneity of the matrix variance - covariance
anova(betadisper(dist(pca.dat),data$Species))

# LDA constrained by species
(ldaSpecies=lda(pca.dat, data$Species))  

# Cross-validation of the dataset
# tableclass=base::table(bloody$Species, ldaSpecies$lass)
MVA.cv(pca.dat, data$Species, model = "LDA", scale=T)
```

```{r, fig.cap="Fig 6. LDA visualised by species"}
par(mfrow = c(1,2))
MVA.plot(ldaSpecies, fac = data$Species, xlab = "LD 1", ylab = "LD 2",
         col = c("#427EF6", "#7C3918", "#FF9100"), legend = F, legend.cex = 0.5,
         legend.pos = "topleft", 
         legend.lab = c("Accipiter gentilis", "Buteo buteo","Milvus milvus"))
MVA.plot(ldaSpecies, "corr", xlab = "Axis 1", ylab = "Axis 2")
```
##### LDA constrained by Infection class

```{r, fig.cap="Fig 7. LDA with prevelance as response. All speices pooled", warning=FALSE}
# Checking for homogeneity within the variance-covariance matrix (equivalent of homoscedasticity of univariate test)
anova(betadisper(dist(pca.dat),data$Infectionclass))
anova(betadisper(dist(pca.dat),data$Infection_binomial))

ldaInfclass = lda(pca.dat, data$Infectionclass)   #  CV=T
ldaInfclass = lda(pca.dat, data$Infection_binomial)   #  CV=T

# Infection (0/1) in the three species

MVA.cv(pca.dat, data$Infection_binomial, model="LDA", scale=T)

par(mfrow = c(1,2))
MVA.plot(ldaInfclass, fac = data$Infection_binomial,
         xlab = "Axis 1", 
         ylab = "Axis 2",
         main="LDA - Blood chemistry in uninfected \n and infected nestlings (all species)",
         col = c("#427EF6", "#7C3918"),
         legend = T,
         legend.cex = 0.9,
         legend.pos = "topright",
         legend.lab = c("Uninfected", "Infected")) # need to adjust the size of the box 

MVA.plot(ldaInfclass,"corr", xlab = "Axis 1", ylab = "Axis 2")
```

```{r, fig.cap="Fig 8. LDA with prevelance as response. Buteo buteo only", warning=F}
# Infection (0/1) in Buteo buteo

buteo <- which(data$Species == "Buteo buteo")

MVA.cv(pca.dat[buteo,], data$Infection_binomial[buteo], model="LDA", scale=T)

ldaInfclass_buteo = lda(pca.dat[buteo,], data$Infection_binomial[buteo])   #  CV=T

par(mfrow = c(1,2))
MVA.plot(ldaInfclass_buteo, fac = data$Infection_binomial[buteo],
         xlab = "Axis 1", 
         ylab = "Axis 2",
         main="LDA - Blood chemistry in uninfected \n and infected nestlings (Buteo buteo)",
         col = c("#427EF6", "#7C3918"),# "#FF9100"),
         legend = T,
         legend.cex = 0.9, 
         legend.pos = "topright",
         legend.lab = c("Uninfected", "Infected"))
MVA.plot(ldaInfclass_buteo,"corr", xlab = "Axis 1", ylab = "Axis 2")
```

```{r, fig.cap="Fig 9. LDA with prevelance as response. Accipiter gentilis only", warning=FALSE}
# Infection (0/1) in Accipiter gentilis

Agentilis <- which(data$Species == "Accipiter gentilis")

MVA.cv(pca.dat[Agentilis,], data$Infection_binomial[Agentilis], model="LDA", scale=T)

ldaInfclass_agentilis = lda(pca.dat[Agentilis,], data$Infection_binomial[Agentilis])   #  CV=T

par(mfrow = c(1,2))
MVA.plot(ldaInfclass_agentilis, fac = data$Infection_binomial[Agentilis],
         main="LDA - Blood chemistry in uninfected \n and infected nestlings (Accipiter gentilis)",
         xlab = "Axis 1", 
         ylab = "Axis 2",
         col = c("#427EF6", "#7C3918"),# "#FF9100"),
         legend = T,
         legend.cex = 0.9, 
         legend.pos = "topleft",
         legend.lab = c("Uninfected", "Infected"))
MVA.plot(ldaInfclass_agentilis,"corr", xlab = "Axis 1", ylab = "Axis 2")
```

```{r, fig.cap="Fig 10. LDA with prevelance as response. Milvus milvus only", warning=FALSE}
# Infection (0/1) in Milvus milvus

milvus <- which(data$Species == "Milvus milvus")

MVA.cv(pca.dat[milvus,], data$Infection_binomial[milvus], model="LDA", scale=T)

ldaInfclass_milvus = lda(pca.dat[milvus,], data$Infection_binomial[milvus])   #  CV=T

par(mfrow = c(1,2))
MVA.plot(ldaInfclass_milvus, fac = data$Infection_binomial[milvus],
         main="LDA - Blood chemistry in uninfected \n and infected nestlings (Milvus milvus)",
         xlab = "Axis 1", 
         ylab = "Axis 2",
         col = c("#427EF6", "#7C3918"),# "#FF9100"),
         legend = T,
         legend.cex = 0.9, 
         legend.pos = "topleft",
         legend.lab = c("Uninfected", "Infected"))

         #legend.lab = c("High Infection", "Low Infection","No Infection"))
MVA.plot(ldaInfclass_milvus,"corr", xlab = "Axis 1", ylab = "Axis 2")

```

##### LDA constrained by Age classes Three weeks / A month / A month+

*Only explorative*

```{r, warning=FALSE}
anova(betadisper(dist(pca.dat),data$AgeClass))

ldaAge=lda(pca.dat, data$AgeClass)   #  CV=T

MVA.cv(pca.dat, data$AgeClass,model="LDA", scale=T)
par(mfrow=c(1,2))
MVA.plot(ldaAge, fac = data$AgeClass, 
         xlab = "Axis 1", ylab = "Axis 2",
         col=c("#427EF6", "#7C3918", "#FF9100"),
         legend=F, legend.cex=0.9, legend.pos="topleft")
MVA.plot(ldaAge,"corr", xlab="Axis 1", ylab="Axis 2")
```

##### LDA constrained by Age classes first, second and third third of their nestling period

*Only explorative*

```{r, warning=FALSE}
anova(betadisper(dist(pca.dat),data$AgeClass2))

ldaAge=lda(pca.dat, data$AgeClass2)   #  CV=T

MVA.cv(pca.dat, data$Infectionclass,model="LDA", scale=T)
par(mfrow=c(1,2))
MVA.plot(ldaAge, fac = data$AgeClass, 
         xlab = "Axis 1", ylab = "Axis 2",
         col=c("#427EF6", "#7C3918", "#FF9100"),
         legend=F, legend.cex=0.9, legend.pos="topleft")
MVA.plot(ldaAge,"corr", xlab="Axis 1", ylab="Axis 2")
```

#### C.) Linear models 

*In all linear models, infection status is represented as a factor with two levels (Infected vs Uninfected) to balance sample sizes*

##### Test 1: *Heterophiles are significantly higher in infected individuals across species*

```{r}
heterophiles_plot <- ggplot(data, aes(x = as.factor(Infection_binomial), y = Heterophiles_percent)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  theme_classic() +
  theme(text = element_text(size = 12),
        panel.border = element_blank(),
        plot.margin = grid::unit(c(2,2,2,2), 'mm')) +
  ylab("Heterophiles [%]") +
  xlab("Leucocytozoon infection") +
  stat_n_text() +
  facet_wrap(~Species) 
heterophiles_plot
```


```{r}
model <- lm(Heterophiles_percent ~ Infection_binomial + Sex + Age + Species, data)
tab_model(model,
          show.stat = T,
          string.est = "Estimate",
          string.ci = "95% CI",
          string.stat = "z",
          string.se = "SE",
          show.se = T,
          transform = NULL,
          collapse.ci = T)
```
```{r, echo=FALSE}
model.plot <- 
  plot_model(model = model,
             sort.est = TRUE,
             transform = NULL,
             title = "",
             ci.lvl = .95,
             ci.style = "whisker",
             dot.size = 3,
             line.size = 1.2,
  ) +
  theme_classic(base_size = 12) +
  geom_hline(yintercept = 0, lty = "dashed") +
  ylab("Effect size") + xlab("Model parameter") +
  ggtitle(label = "Heterophiles_percent ~ Infection_binomial + Sex + Age + Species") 
#model.plot
```

```{r, echo=F}
## model predictions
(df.pred <- data.frame(
  Infection_binomial = rep(as.factor(0:1), 2),
  Species = rep(c("Milvus milvus"), each = 4),
  Sex = rep(c(rep("Female", 2), rep("Male", 2)),1),
  Age = 0))

fitted.values <- predict(model, df.pred, se.fit = T, interval = "confidence")
means <- fitted.values$fit[,1]
se <- fitted.values$se.fit
df.pred <- cbind(df.pred, means, se)

model.summary <- summary(model)

summary.table <- data.frame(param = "Heterophiles",
           Mean.0 = mean(df.pred$means[df.pred$Infection_binomial == 0]),
           SE.0 = mean(df.pred$se[df.pred$Infection_binomial == 0]),
           Mean.1 = mean(df.pred$means[df.pred$Infection_binomial == 1]),
           SE.1 = mean(df.pred$se[df.pred$Infection_binomial == 1]),
           t = model.summary$coefficients[2,3],
           p = model.summary$coefficients[2,4])
```


##### Test 2: *Lymphocytes are significantly lower in infected individuals across species*

```{r}
lymphocytes_plot <- ggplot(data,
                            aes(x = as.factor(Infection_binomial), y = Lymphocytes_percent)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  theme_classic() +
  theme(text = element_text(size = 12),
        panel.border = element_blank(),
        #strip.background = element_rect(fill = "white", colour = "white"),
        #strip.text = element_text(colour = 'white'),
        plot.margin = grid::unit(c(2,2,2,2), 'mm')) +
  ylab("Lymphocytes [%]") +
  xlab("Leucocytozoon infection") +
  stat_n_text() +
  facet_wrap(~Species) 
lymphocytes_plot
```


```{r}
model <- lm(Lymphocytes_percent ~ Infection_binomial + Sex + Age + Species, data)
tab_model(model,
          show.stat = T,
          string.est = "Estimate",
          string.ci = "95% CI",
          string.stat = "z",
          string.se = "SE",
          show.se = T,
          transform = NULL,
          collapse.ci = T)
```

```{r, echo=FALSE}
model.plot <- 
  plot_model(model = model,
             sort.est = TRUE,
             transform = NULL,
             title = "",
             ci.lvl = .95,
             ci.style = "whisker",
             dot.size = 3,
             line.size = 1.2,
  ) +
  theme_classic(base_size = 12) +
  geom_hline(yintercept = 0, lty = "dashed") +
  ylab("Effect size") + xlab("Model parameter") +
  ggtitle(label = "Lymphocytes_percent ~ Infection_binomial + Sex + Age + Species") 
#model.plot
```

```{r, echo=FALSE, eval = F}
## model predictions
(df.pred <- data.frame(
  Infection_binomial = rep(as.factor(0:1), 2),
  Species = rep(c("Milvus milvus"), each = 4),
  Sex = rep(c(rep("Female", 2), rep("Male", 2)),1),
  Age = 0))

fitted.values <- predict(model, df.pred, se.fit = T, interval = "confidence")
means <- fitted.values$fit[,1]
se <- fitted.values$se.fit
df.pred <- cbind(df.pred, means, se)

model.summary <- summary(model)

summary.table <-
  rbind(summary.table, data.frame(
    param = "Lymphocytes",
    Mean.0 = mean(df.pred$means[df.pred$Infection_binomial == 0]),
    SE.0 = mean(df.pred$se[df.pred$Infection_binomial == 0]),
    Mean.1 = mean(df.pred$means[df.pred$Infection_binomial == 1]),
    SE.1 = mean(df.pred$se[df.pred$Infection_binomial == 1]),
    t = model.summary$coefficients[2,3],
    p = model.summary$coefficients[2,4])
  )
```


##### Test 3: *BA is significantly higher in infected individuals across species*

```{r}
BA_plot <- ggplot(data, aes(x = as.factor(Infection_binomial), y = BA)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  theme_classic() +
  theme(text = element_text(size = 12),
        panel.border = element_blank(),
        #strip.background = element_rect(fill = "white", colour = "white"),
        #strip.text = element_text(colour = 'white'),
        plot.margin = grid::unit(c(2,2,2,2), 'mm')) +
  ylab("BA [%]") +
  xlab("Leucocytozoon infection") +
  stat_n_text() +
  facet_wrap(~Species) 
BA_plot
```


```{r}
model <- lm(BA ~ Infection_binomial + Sex + Age + Species, data) 
tab_model(model,
          show.stat = T,
          string.est = "Estimate",
          string.ci = "95% CI",
          string.stat = "z",
          string.se = "SE",
          show.se = T,
          transform = NULL,
          collapse.ci = T)
```

```{r, echo=FALSE}

model.plot <- 
  plot_model(model = model,
             sort.est = TRUE,
             transform = NULL,
             title = "",
             ci.lvl = .95,
             ci.style = "whisker",
             dot.size = 3,
             line.size = 1.2,
  ) +
  theme_classic(base_size = 12) +
  geom_hline(yintercept = 0, lty = "dashed") +
  ylab("Effect size") + xlab("Model parameter") +
  ggtitle(label = "BA ~ Infection_binomial + Sex + Age + Species") 
#model.plot
```
```{r, echo=FALSE, eval = F}
## model predictions
(df.pred <- data.frame(
  Infection_binomial = rep(as.factor(0:1), 2),
  Species = rep(c("Milvus milvus"), each = 4),
  Sex = rep(c(rep("Female", 2), rep("Male", 2)),1),
  Age = 0))

fitted.values <- predict(model, df.pred, se.fit = T, interval = "confidence")
means <- fitted.values$fit[,1]
se <- fitted.values$se.fit
df.pred <- cbind(df.pred, means, se)

model.summary <- summary(model)

summary.table <-
  rbind(summary.table, data.frame(
    param = "BA",
    Mean.0 = mean(df.pred$means[df.pred$Infection_binomial == 0]),
    SE.0 = mean(df.pred$se[df.pred$Infection_binomial == 0]),
    Mean.1 = mean(df.pred$means[df.pred$Infection_binomial == 1]),
    SE.1 = mean(df.pred$se[df.pred$Infection_binomial == 1]),
    t = model.summary$coefficients[2,3],
    p = model.summary$coefficients[2,4])
  )
```

##### Test 4: *AST is significantly higher in infected individuals across species*

```{r}
AST_plot <- ggplot(data, aes(x = as.factor(Infection_binomial), y = AST)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  theme_classic() +
  theme(text = element_text(size = 12),
        panel.border = element_blank(),
        plot.margin = grid::unit(c(2,2,2,2), 'mm')) +
  ylab("AST [%]") +
  xlab("Leucocytozoon infection") +
  stat_n_text() +
  facet_wrap(~Species) 
AST_plot
```


```{r}
model <- lm(AST ~ Infection_binomial + Sex + Age + Species, data) 
tab_model(model,
          show.stat = T,
          string.est = "Estimate",
          string.ci = "95% CI",
          string.stat = "z",
          string.se = "SE",
          show.se = T,
          transform = NULL,
          collapse.ci = T)
```

```{r, echo=FALSE}
model.plot <- 
  plot_model(model = model,
             sort.est = TRUE,
             transform = NULL,
             title = "",
             ci.lvl = .95,
             ci.style = "whisker",
             dot.size = 3,
             line.size = 1.2,
  ) +
  theme_classic(base_size = 12) +
  geom_hline(yintercept = 0, lty = "dashed") +
  ylab("Effect size") + xlab("Model parameter") +
  ggtitle(label = "AST ~ Infection_binomial + Sex + Age + Species") 
#model.plot
```

```{r, echo=FALSE, eval = F}
## model predictions
(df.pred <- data.frame(
  Infection_binomial = rep(as.factor(0:1), 2),
  Species = rep(c("Milvus milvus"), each = 4),
  Sex = rep(c(rep("Female", 2), rep("Male", 2)),1),
  Age = 0))

fitted.values <- predict(model, df.pred, se.fit = T, interval = "confidence")
means <- fitted.values$fit[,1]
se <- fitted.values$se.fit
df.pred <- cbind(df.pred, means, se)

model.summary <- summary(model)

summary.table <-
  rbind(summary.table, data.frame(
    param = "AST",
    Mean.0 = mean(df.pred$means[df.pred$Infection_binomial == 0]),
    SE.0 = mean(df.pred$se[df.pred$Infection_binomial == 0]),
    Mean.1 = mean(df.pred$means[df.pred$Infection_binomial == 1]),
    SE.1 = mean(df.pred$se[df.pred$Infection_binomial == 1]),
    t = model.summary$coefficients[2,3],
    p = model.summary$coefficients[2,4])
  )
```

##### Test 5: *LDH is significantly higher in infected individuals across species*

```{r}
LDH_plot <- ggplot(data, aes(x = as.factor(Infection_binomial), y = LDH)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  theme_classic() +
  theme(text = element_text(size = 12),
        panel.border = element_blank(),
        plot.margin = grid::unit(c(2,2,2,2), 'mm')) +
  ylab("LDH [%]") +
  xlab("Leucocytozoon infection") +
  stat_n_text() +
  facet_wrap(~Species) 
LDH_plot
```

```{r}
model <- lm(LDH ~ Infection_binomial + Sex + Age + Species, data)
tab_model(model,
          show.stat = T,
          string.est = "Estimate",
          string.ci = "95% CI",
          string.stat = "z",
          string.se = "SE",
          show.se = T,
          transform = NULL,
          collapse.ci = T)
```

```{r, echo=FALSE}

model.plot <- 
  plot_model(model = model,
             sort.est = TRUE,
             transform = NULL,
             title = "",
             ci.lvl = .95,
             ci.style = "whisker",
             dot.size = 3,
             line.size = 1.2,
  ) +
  theme_classic(base_size = 12) +
  geom_hline(yintercept = 0, lty = "dashed") +
  ylab("Effect size") + xlab("Model parameter") +
  ggtitle(label = "LDH ~ Infection_binomial + Sex + Age + Species") 
#model.plot
```

```{r, echo=FALSE, eval = F}
## model predictions
(df.pred <- data.frame(
  Infection_binomial = rep(as.factor(0:1), 2),
  Species = rep(c("Milvus milvus"), each = 4),
  Sex = rep(c(rep("Female", 2), rep("Male", 2)),1),
  Age = 0))

fitted.values <- predict(model, df.pred, se.fit = T, interval = "confidence")
means <- fitted.values$fit[,1]
se <- fitted.values$se.fit
df.pred <- cbind(df.pred, means, se)

model.summary <- summary(model)

summary.table <-
  rbind(summary.table, data.frame(
    param = "LDH",
    Mean.0 = mean(df.pred$means[df.pred$Infection_binomial == 0]),
    SE.0 = mean(df.pred$se[df.pred$Infection_binomial == 0]),
    Mean.1 = mean(df.pred$means[df.pred$Infection_binomial == 1]),
    SE.1 = mean(df.pred$se[df.pred$Infection_binomial == 1]),
    t = model.summary$coefficients[2,3],
    p = model.summary$coefficients[2,4])
  )
```

##### Test 6: *Eosinophiles is significantly higher in infected individuals across species*

```{r}
Eosinophiles_plot <- ggplot(data, aes(x = as.factor(Infection_binomial), y = Eosinophiles_percent)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  theme_classic() +
  theme(text = element_text(size = 12),
        panel.border = element_blank(),
        plot.margin = grid::unit(c(2,2,2,2), 'mm')) +
  ylab("Eosinophiles [%]") +
  xlab("Leucocytozoon infection") +
  stat_n_text() +
  facet_wrap(~Species) 
Eosinophiles_plot
```

```{r}
model <- lm(Eosinophiles_percent ~ Infection_binomial + Sex + Age + Species, data)
tab_model(model,
          show.stat = T,
          string.est = "Estimate",
          string.ci = "95% CI",
          string.stat = "z",
          string.se = "SE",
          show.se = T,
          transform = NULL,
          collapse.ci = T)
```

```{r, echo=FALSE}

model.plot <- 
  plot_model(model = model,
             sort.est = TRUE,
             transform = NULL,
             title = "",
             ci.lvl = .95,
             ci.style = "whisker",
             dot.size = 3,
             line.size = 1.2,
  ) +
  theme_classic(base_size = 12) +
  geom_hline(yintercept = 0, lty = "dashed") +
  ylab("Effect size") + xlab("Model parameter") +
  ggtitle(label = "Eosinophiles ~ Infection_binomial + Sex + Age + Species") 
#model.plot
```

```{r, echo=FALSE, eval = F}
## model predictions
(df.pred <- data.frame(
  Infection_binomial = rep(as.factor(0:1), 2),
  Species = rep(c("Milvus milvus"), each = 4),
  Sex = rep(c(rep("Female", 2), rep("Male", 2)),1),
  Age = 0))

fitted.values <- predict(model, df.pred, se.fit = T, interval = "confidence")
means <- fitted.values$fit[,1]
se <- fitted.values$se.fit
df.pred <- cbind(df.pred, means, se)

model.summary <- summary(model)

summary.table <-
  rbind(summary.table, data.frame(
    param = "Eosinophiles",
    Mean.0 = mean(df.pred$means[df.pred$Infection_binomial == 0]),
    SE.0 = mean(df.pred$se[df.pred$Infection_binomial == 0]),
    Mean.1 = mean(df.pred$means[df.pred$Infection_binomial == 1]),
    SE.1 = mean(df.pred$se[df.pred$Infection_binomial == 1]),
    t = model.summary$coefficients[2,3],
    p = model.summary$coefficients[2,4])
  )
```

##### Test 7: *Monocytes do not differ between infeceted and uninfected individuals*

```{r}
Monocytes_plot <- ggplot(data, aes(x = as.factor(Infection_binomial), y = Monocytes_percent)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  theme_classic() +
  theme(text = element_text(size = 12),
        panel.border = element_blank(),
        plot.margin = grid::unit(c(2,2,2,2), 'mm')) +
  ylab("Monocytes [%]") +
  xlab("Leucocytozoon infection") +
  stat_n_text() +
  facet_wrap(~Species) 
Monocytes_plot
```

```{r}
model <- lm(Monocytes_percent ~ Infection_binomial + Sex + Age + Species, data)
tab_model(model,
          show.stat = T,
          string.est = "Estimate",
          string.ci = "95% CI",
          string.stat = "z",
          string.se = "SE",
          show.se = T,
          transform = NULL,
          collapse.ci = T)
```

```{r, echo=FALSE}

model.plot <- 
  plot_model(model = model,
             sort.est = TRUE,
             transform = NULL,
             title = "",
             ci.lvl = .95,
             ci.style = "whisker",
             dot.size = 3,
             line.size = 1.2,
  ) +
  theme_classic(base_size = 12) +
  geom_hline(yintercept = 0, lty = "dashed") +
  ylab("Effect size") + xlab("Model parameter") +
  ggtitle(label = "Monocytes_percent ~ Infection_binomial + Sex + Age + Species") 
#model.plot
```

```{r, echo=FALSE, eval = F}
## model predictions
(df.pred <- data.frame(
  Infection_binomial = rep(as.factor(0:1), 2),
  Species = rep(c("Milvus milvus"), each = 4),
  Sex = rep(c(rep("Female", 2), rep("Male", 2)),1),
  Age = 0))

fitted.values <- predict(model, df.pred, se.fit = T, interval = "confidence")
means <- fitted.values$fit[,1]
se <- fitted.values$se.fit
df.pred <- cbind(df.pred, means, se)

model.summary <- summary(model)

summary.table <-
  rbind(summary.table, data.frame(
    param = "Monocytes",
    Mean.0 = mean(df.pred$means[df.pred$Infection_binomial == 0]),
    SE.0 = mean(df.pred$se[df.pred$Infection_binomial == 0]),
    Mean.1 = mean(df.pred$means[df.pred$Infection_binomial == 1]),
    SE.1 = mean(df.pred$se[df.pred$Infection_binomial == 1]),
    t = model.summary$coefficients[2,3],
    p = model.summary$coefficients[2,4])
  )
```

##### Test 8: *Basophiles do not differ between infeceted and uninfected individuals*

```{r}
Basophiles_plot <- ggplot(data, aes(x = as.factor(Infection_binomial), y = Basophiles_percent)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  theme_classic() +
  theme(text = element_text(size = 12),
        panel.border = element_blank(),
        plot.margin = grid::unit(c(2,2,2,2), 'mm')) +
  ylab("Basophiles [%]") +
  xlab("Leucocytozoon infection") +
  stat_n_text() +
  facet_wrap(~Species) 
Basophiles_plot
```

```{r}
model <- lm(Basophiles_percent ~ Infection_binomial + Sex + Age + Species, data)
tab_model(model,
          show.stat = T,
          string.est = "Estimate",
          string.ci = "95% CI",
          string.stat = "z",
          string.se = "SE",
          show.se = T,
          transform = NULL,
          collapse.ci = T)
```

```{r, echo=FALSE}

model.plot <- 
  plot_model(model = model,
             sort.est = TRUE,
             transform = NULL,
             title = "",
             ci.lvl = .95,
             ci.style = "whisker",
             dot.size = 3,
             line.size = 1.2,
  ) +
  theme_classic(base_size = 12) +
  geom_hline(yintercept = 0, lty = "dashed") +
  ylab("Effect size") + xlab("Model parameter") +
  ggtitle(label = "Basophiles_percent ~ Infection_binomial + Sex + Age + Species") 
#model.plot
```

```{r, echo=FALSE, eval = F}
## model predictions
(df.pred <- data.frame(
  Infection_binomial = rep(as.factor(0:1), 2),
  Species = rep(c("Milvus milvus"), each = 4),
  Sex = rep(c(rep("Female", 2), rep("Male", 2)),1),
  Age = 0))

fitted.values <- predict(model, df.pred, se.fit = T, interval = "confidence")
means <- fitted.values$fit[,1]
se <- fitted.values$se.fit
df.pred <- cbind(df.pred, means, se)

model.summary <- summary(model)

summary.table <-
  rbind(summary.table, data.frame(
    param = "Basophiles",
    Mean.0 = mean(df.pred$means[df.pred$Infection_binomial == 0]),
    SE.0 = mean(df.pred$se[df.pred$Infection_binomial == 0]),
    Mean.1 = mean(df.pred$means[df.pred$Infection_binomial == 1]),
    SE.1 = mean(df.pred$se[df.pred$Infection_binomial == 1]),
    t = model.summary$coefficients[2,3],
    p = model.summary$coefficients[2,4])
  )
```

##### Test 9: *AP do not differ between infeceted and uninfected individuals*

```{r}
AP_plot <- ggplot(data, aes(x = as.factor(Infection_binomial), y = AP)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  theme_classic() +
  theme(text = element_text(size = 12),
        panel.border = element_blank(),
        plot.margin = grid::unit(c(2,2,2,2), 'mm')) +
  ylab("AP") +
  xlab("Leucocytozoon infection") +
  stat_n_text() +
  facet_wrap(~Species) 
AP_plot
```

```{r}
model <- lm(AP ~ Infection_binomial + Sex + Age + Species, data)
tab_model(model,
          show.stat = T,
          string.est = "Estimate",
          string.ci = "95% CI",
          string.stat = "z",
          string.se = "SE",
          show.se = T,
          transform = NULL,
          collapse.ci = T)
```

```{r, echo=FALSE}

model.plot <- 
  plot_model(model = model,
             sort.est = TRUE,
             transform = NULL,
             title = "",
             ci.lvl = .95,
             ci.style = "whisker",
             dot.size = 3,
             line.size = 1.2,
  ) +
  theme_classic(base_size = 12) +
  geom_hline(yintercept = 0, lty = "dashed") +
  ylab("Effect size") + xlab("Model parameter") +
  ggtitle(label = "AP ~ Infection_binomial + Sex + Age + Species") 
#model.plot
```

```{r, echo=FALSE, eval = F}
## model predictions
(df.pred <- data.frame(
  Infection_binomial = rep(as.factor(0:1), 2),
  Species = rep(c("Milvus milvus"), each = 4),
  Sex = rep(c(rep("Female", 2), rep("Male", 2)),1),
  Age = 0))

fitted.values <- predict(model, df.pred, se.fit = T, interval = "confidence")
means <- fitted.values$fit[,1]
se <- fitted.values$se.fit
df.pred <- cbind(df.pred, means, se)

model.summary <- summary(model)

summary.table <-
  rbind(summary.table, data.frame(
    param = "AP",
    Mean.0 = mean(df.pred$means[df.pred$Infection_binomial == 0]),
    SE.0 = mean(df.pred$se[df.pred$Infection_binomial == 0]),
    Mean.1 = mean(df.pred$means[df.pred$Infection_binomial == 1]),
    SE.1 = mean(df.pred$se[df.pred$Infection_binomial == 1]),
    t = model.summary$coefficients[2,3],
    p = model.summary$coefficients[2,4])
  )
```

##### Test 10: *gGT do not differ between infeceted and uninfected individuals*

```{r}
gGT_plot <- ggplot(data, aes(x = as.factor(Infection_binomial), y = gGT)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  theme_classic() +
  theme(text = element_text(size = 12),
        panel.border = element_blank(),
        plot.margin = grid::unit(c(2,2,2,2), 'mm')) +
  ylab("gGT") +
  xlab("Leucocytozoon infection") +
  stat_n_text() +
  facet_wrap(~Species) 
gGT_plot
```

```{r}
model <- lm(gGT ~ Infection_binomial + Sex + Age + Species, data)
tab_model(model,
          show.stat = T,
          string.est = "Estimate",
          string.ci = "95% CI",
          string.stat = "z",
          string.se = "SE",
          show.se = T,
          transform = NULL,
          collapse.ci = T)
```

```{r, echo=FALSE}

model.plot <- 
  plot_model(model = model,
             sort.est = TRUE,
             transform = NULL,
             title = "",
             ci.lvl = .95,
             ci.style = "whisker",
             dot.size = 3,
             line.size = 1.2,
  ) +
  theme_classic(base_size = 12) +
  geom_hline(yintercept = 0, lty = "dashed") +
  ylab("Effect size") + xlab("Model parameter") +
  ggtitle(label = "gGT ~ Infection_binomial + Sex + Age + Species") 
#model.plot
```

```{r, echo=FALSE, eval = F}
## model predictions
(df.pred <- data.frame(
  Infection_binomial = rep(as.factor(0:1), 2),
  Species = rep(c("Milvus milvus"), each = 4),
  Sex = rep(c(rep("Female", 2), rep("Male", 2)),1),
  Age = 0))

fitted.values <- predict(model, df.pred, se.fit = T, interval = "confidence")
means <- fitted.values$fit[,1]
se <- fitted.values$se.fit
df.pred <- cbind(df.pred, means, se)

model.summary <- summary(model)

summary.table <-
  rbind(summary.table, data.frame(
    param = "gGT",
    Mean.0 = mean(df.pred$means[df.pred$Infection_binomial == 0]),
    SE.0 = mean(df.pred$se[df.pred$Infection_binomial == 0]),
    Mean.1 = mean(df.pred$means[df.pred$Infection_binomial == 1]),
    SE.1 = mean(df.pred$se[df.pred$Infection_binomial == 1]),
    t = model.summary$coefficients[2,3],
    p = model.summary$coefficients[2,4])
  )
```

##### Test 11: *CHE do not differ between infeceted and uninfected individuals*

```{r}
CHE_plot <- ggplot(data, aes(x = as.factor(Infection_binomial), y = CHE)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  theme_classic() +
  theme(text = element_text(size = 12),
        panel.border = element_blank(),
        plot.margin = grid::unit(c(2,2,2,2), 'mm')) +
  ylab("CHE") +
  xlab("Leucocytozoon infection") +
  stat_n_text() +
  facet_wrap(~Species) 
CHE_plot
```

```{r}
model <- lm(CHE ~ Infection_binomial + Sex + Age + Species, data)
tab_model(model,
          show.stat = T,
          string.est = "Estimate",
          string.ci = "95% CI",
          string.stat = "z",
          string.se = "SE",
          show.se = T,
          transform = NULL,
          collapse.ci = T)
```

```{r, echo=FALSE}

model.plot <- 
  plot_model(model = model,
             sort.est = TRUE,
             transform = NULL,
             title = "",
             ci.lvl = .95,
             ci.style = "whisker",
             dot.size = 3,
             line.size = 1.2,
  ) +
  theme_classic(base_size = 12) +
  geom_hline(yintercept = 0, lty = "dashed") +
  ylab("Effect size") + xlab("Model parameter") +
  ggtitle(label = "CHE ~ Infection_binomial + Sex + Age + Species") 
#model.plot
```

```{r, echo=FALSE, eval = F}
## model predictions
(df.pred <- data.frame(
  Infection_binomial = rep(as.factor(0:1), 2),
  Species = rep(c("Milvus milvus"), each = 4),
  Sex = rep(c(rep("Female", 2), rep("Male", 2)),1),
  Age = 0))

fitted.values <- predict(model, df.pred, se.fit = T, interval = "confidence")
means <- fitted.values$fit[,1]
se <- fitted.values$se.fit
df.pred <- cbind(df.pred, means, se)

model.summary <- summary(model)

summary.table <-
  rbind(summary.table, data.frame(
    param = "CHE",
    Mean.0 = mean(df.pred$means[df.pred$Infection_binomial == 0]),
    SE.0 = mean(df.pred$se[df.pred$Infection_binomial == 0]),
    Mean.1 = mean(df.pred$means[df.pred$Infection_binomial == 1]),
    SE.1 = mean(df.pred$se[df.pred$Infection_binomial == 1]),
    t = model.summary$coefficients[2,3],
    p = model.summary$coefficients[2,4])
  )
```

##### Test 12: *GLDH do not differ between infected and uninfected individuals*

Spurious!

```{r}
GLDH_plot <- ggplot(data, aes(x = as.factor(Infection_binomial), y = GLDH)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  theme_classic() +
  theme(text = element_text(size = 12),
        panel.border = element_blank(),
        plot.margin = grid::unit(c(2,2,2,2), 'mm')) +
  ylab("GLDH") +
  xlab("Leucocytozoon infection") +
  stat_n_text() +
  facet_wrap(~Species) 
GLDH_plot
```

```{r}
model <- lm(GLDH ~ Infection_binomial + Sex + Age + Species, data)
tab_model(model,
          show.stat = T,
          string.est = "Estimate",
          string.ci = "95% CI",
          string.stat = "z",
          string.se = "SE",
          show.se = T,
          transform = NULL,
          collapse.ci = T)
```

```{r, echo=FALSE}

model.plot <- 
  plot_model(model = model,
             sort.est = TRUE,
             transform = NULL,
             title = "",
             ci.lvl = .95,
             ci.style = "whisker",
             dot.size = 3,
             line.size = 1.2,
  ) +
  theme_classic(base_size = 12) +
  geom_hline(yintercept = 0, lty = "dashed") +
  ylab("Effect size") + xlab("Model parameter") +
  ggtitle(label = "GLDH ~ Infection_binomial + Sex + Age + Species") 
#model.plot
```

```{r, echo=FALSE, eval = F}
## model predictions
(df.pred <- data.frame(
  Infection_binomial = rep(as.factor(0:1), 2),
  Species = rep(c("Milvus milvus"), each = 4),
  Sex = rep(c(rep("Female", 2), rep("Male", 2)),1),
  Age = 0))

fitted.values <- predict(model, df.pred, se.fit = T, interval = "confidence")
means <- fitted.values$fit[,1]
se <- fitted.values$se.fit
df.pred <- cbind(df.pred, means, se)

model.summary <- summary(model)

summary.table <-
  rbind(summary.table, data.frame(
    param = "GLDH",
    Mean.0 = mean(df.pred$means[df.pred$Infection_binomial == 0]),
    SE.0 = mean(df.pred$se[df.pred$Infection_binomial == 0]),
    Mean.1 = mean(df.pred$means[df.pred$Infection_binomial == 1]),
    SE.1 = mean(df.pred$se[df.pred$Infection_binomial == 1]),
    t = model.summary$coefficients[2,3],
    p = model.summary$coefficients[2,4])
  )
```

##### Test 13: *CK do not differ between infeceted and uninfected individuals*

```{r}
CK_plot <- ggplot(data, aes(x = as.factor(Infection_binomial), y = CK)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  theme_classic() +
  theme(text = element_text(size = 12),
        panel.border = element_blank(),
        plot.margin = grid::unit(c(2,2,2,2), 'mm')) +
  ylab("GLDH") +
  xlab("Leucocytozoon infection") +
  stat_n_text() +
  facet_wrap(~Species) 
CK_plot
```

```{r}
model <- lm(CK ~ Infection_binomial + Sex + Age + Species, data)
tab_model(model,
          show.stat = T,
          string.est = "Estimate",
          string.ci = "95% CI",
          string.stat = "z",
          string.se = "SE",
          show.se = T,
          transform = NULL,
          collapse.ci = T)
```

```{r, echo=FALSE}

model.plot <- 
  plot_model(model = model,
             sort.est = TRUE,
             transform = NULL,
             title = "",
             ci.lvl = .95,
             ci.style = "whisker",
             dot.size = 3,
             line.size = 1.2,
  ) +
  theme_classic(base_size = 12) +
  geom_hline(yintercept = 0, lty = "dashed") +
  ylab("Effect size") + xlab("Model parameter") +
  ggtitle(label = "CK ~ Infection_binomial + Sex + Age + Species") 
#model.plot
```

```{r, echo=FALSE, eval = F}
## model predictions
(df.pred <- data.frame(
  Infection_binomial = rep(as.factor(0:1), 2),
  Species = rep(c("Milvus milvus"), each = 4),
  Sex = rep(c(rep("Female", 2), rep("Male", 2)),1),
  Age = 0))

fitted.values <- predict(model, df.pred, se.fit = T, interval = "confidence")
means <- fitted.values$fit[,1]
se <- fitted.values$se.fit
df.pred <- cbind(df.pred, means, se)

model.summary <- summary(model)

summary.table <-
  rbind(summary.table, data.frame(
    param = "CK",
    Mean.0 = mean(df.pred$means[df.pred$Infection_binomial == 0]),
    SE.0 = mean(df.pred$se[df.pred$Infection_binomial == 0]),
    Mean.1 = mean(df.pred$means[df.pred$Infection_binomial == 1]),
    SE.1 = mean(df.pred$se[df.pred$Infection_binomial == 1]),
    t = model.summary$coefficients[2,3],
    p = model.summary$coefficients[2,4])
  )
```

##### Test 14: *ALB do not differ between infeceted and uninfected individuals*

```{r}
ALB_plot <- ggplot(data, aes(x = as.factor(Infection_binomial), y = ALB)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  theme_classic() +
  theme(text = element_text(size = 12),
        panel.border = element_blank(),
        plot.margin = grid::unit(c(2,2,2,2), 'mm')) +
  ylab("ALB") +
  xlab("Leucocytozoon infection") +
  stat_n_text() +
  facet_wrap(~Species) 
ALB_plot
```

```{r}
model <-lm(ALB ~ Infection_binomial + Sex + Age + Species, data)
tab_model(model,
          show.stat = T,
          string.est = "Estimate",
          string.ci = "95% CI",
          string.stat = "z",
          string.se = "SE",
          show.se = T,
          transform = NULL,
          collapse.ci = T)
```

```{r, echo=FALSE}

model.plot <- 
  plot_model(model = model,
             sort.est = TRUE,
             transform = NULL,
             title = "",
             ci.lvl = .95,
             ci.style = "whisker",
             dot.size = 3,
             line.size = 1.2,
  ) +
  theme_classic(base_size = 12) +
  geom_hline(yintercept = 0, lty = "dashed") +
  ylab("Effect size") + xlab("Model parameter") +
  ggtitle(label = "ALB ~ Infection_binomial + Sex + Age + Species") 
#model.plot
```

```{r, echo=FALSE, eval = F}
## model predictions
(df.pred <- data.frame(
  Infection_binomial = rep(as.factor(0:1), 2),
  Species = rep(c("Milvus milvus"), each = 4),
  Sex = rep(c(rep("Female", 2), rep("Male", 2)),1),
  Age = 0))

fitted.values <- predict(model, df.pred, se.fit = T, interval = "confidence")
means <- fitted.values$fit[,1]
se <- fitted.values$se.fit
df.pred <- cbind(df.pred, means, se)

model.summary <- summary(model)

summary.table <-
  rbind(summary.table, data.frame(
    param = "ALB",
    Mean.0 = mean(df.pred$means[df.pred$Infection_binomial == 0]),
    SE.0 = mean(df.pred$se[df.pred$Infection_binomial == 0]),
    Mean.1 = mean(df.pred$means[df.pred$Infection_binomial == 1]),
    SE.1 = mean(df.pred$se[df.pred$Infection_binomial == 1]),
    t = model.summary$coefficients[2,3],
    p = model.summary$coefficients[2,4])
  )
```

##### Test 15: *TP do not differ between infeceted and uninfected individuals*

```{r}
TP_plot <- ggplot(data, aes(x = as.factor(Infection_binomial), y = TP)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  theme_classic() +
  theme(text = element_text(size = 12),
        panel.border = element_blank(),
        plot.margin = grid::unit(c(2,2,2,2), 'mm')) +
  ylab("TP") +
  xlab("Leucocytozoon infection") +
  stat_n_text() +
  facet_wrap(~Species) 
TP_plot
```

```{r}
model <- lm(TP ~ Infection_binomial + Sex + Age + Species, data)
tab_model(model,
          show.stat = T,
          string.est = "Estimate",
          string.ci = "95% CI",
          string.stat = "z",
          string.se = "SE",
          show.se = T,
          transform = NULL,
          collapse.ci = T)
```

```{r, echo=FALSE}

model.plot <- 
  plot_model(model = model,
             sort.est = TRUE,
             transform = NULL,
             title = "",
             ci.lvl = .95,
             ci.style = "whisker",
             dot.size = 3,
             line.size = 1.2,
  ) +
  theme_classic(base_size = 12) +
  geom_hline(yintercept = 0, lty = "dashed") +
  ylab("Effect size") + xlab("Model parameter") +
  ggtitle(label = "TP ~ Infection_binomial + Sex + Age + Species") 
#model.plot
```

```{r, echo=FALSE, eval = F}
## model predictions
(df.pred <- data.frame(
  Infection_binomial = rep(as.factor(0:1), 2),
  Species = rep(c("Milvus milvus"), each = 4),
  Sex = rep(c(rep("Female", 2), rep("Male", 2)),1),
  Age = 0))

fitted.values <- predict(model, df.pred, se.fit = T, interval = "confidence")
means <- fitted.values$fit[,1]
se <- fitted.values$se.fit
df.pred <- cbind(df.pred, means, se)

model.summary <- summary(model)

summary.table <-
  rbind(summary.table, data.frame(
    param = "TP",
    Mean.0 = mean(df.pred$means[df.pred$Infection_binomial == 0]),
    SE.0 = mean(df.pred$se[df.pred$Infection_binomial == 0]),
    Mean.1 = mean(df.pred$means[df.pred$Infection_binomial == 1]),
    SE.1 = mean(df.pred$se[df.pred$Infection_binomial == 1]),
    t = model.summary$coefficients[2,3],
    p = model.summary$coefficients[2,4])
  )
```

##### Test 16: *Ca do not differ between infeceted and uninfected individuals*

```{r}
Ca_plot <- ggplot(data, aes(x = as.factor(Infection_binomial), y = Ca)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  theme_classic() +
  theme(text = element_text(size = 12),
        panel.border = element_blank(),
        plot.margin = grid::unit(c(2,2,2,2), 'mm')) +
  ylab("Ca") +
  xlab("Leucocytozoon infection") +
  stat_n_text() +
  facet_wrap(~Species) 
Ca_plot
```

```{r}
model <- lm(Ca ~ Infection_binomial + Sex + Age + Species, data) 
tab_model(model,
          show.stat = T,
          string.est = "Estimate",
          string.ci = "95% CI",
          string.stat = "z",
          string.se = "SE",
          show.se = T,
          transform = NULL,
          collapse.ci = T)
```

```{r, echo=FALSE}

model.plot <- 
  plot_model(model = model,
             sort.est = TRUE,
             transform = NULL,
             title = "",
             ci.lvl = .95,
             ci.style = "whisker",
             dot.size = 3,
             line.size = 1.2,
  ) +
  theme_classic(base_size = 12) +
  geom_hline(yintercept = 0, lty = "dashed") +
  ylab("Effect size") + xlab("Model parameter") +
  ggtitle(label = "CA ~ Infection_binomial + Sex + Age + Species") 
#model.plot
```

```{r, echo=FALSE, eval = F}
## model predictions
(df.pred <- data.frame(
  Infection_binomial = rep(as.factor(0:1), 2),
  Species = rep(c("Milvus milvus"), each = 4),
  Sex = rep(c(rep("Female", 2), rep("Male", 2)),1),
  Age = 0))

fitted.values <- predict(model, df.pred, se.fit = T, interval = "confidence")
means <- fitted.values$fit[,1]
se <- fitted.values$se.fit
df.pred <- cbind(df.pred, means, se)

model.summary <- summary(model)

summary.table <-
  rbind(summary.table, data.frame(
    param = "CA",
    Mean.0 = mean(df.pred$means[df.pred$Infection_binomial == 0]),
    SE.0 = mean(df.pred$se[df.pred$Infection_binomial == 0]),
    Mean.1 = mean(df.pred$means[df.pred$Infection_binomial == 1]),
    SE.1 = mean(df.pred$se[df.pred$Infection_binomial == 1]),
    t = model.summary$coefficients[2,3],
    p = model.summary$coefficients[2,4])
  )
```

##### Test 17: *P do not differ between infeceted and uninfected individuals*

```{r}
P_plot <- ggplot(data, aes(x = as.factor(Infection_binomial), y = P)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  theme_classic() +
  theme(text = element_text(size = 12),
        panel.border = element_blank(),
        plot.margin = grid::unit(c(2,2,2,2), 'mm')) +
  ylab("P") +
  xlab("Leucocytozoon infection") +
  stat_n_text() +
  facet_wrap(~Species) 
P_plot
```

```{r}
model <- lm(P ~ Infection_binomial + Sex + Age + Species, data)
tab_model(model,
          show.stat = T,
          string.est = "Estimate",
          string.ci = "95% CI",
          string.stat = "z",
          string.se = "SE",
          show.se = T,
          transform = NULL,
          collapse.ci = T)
```

```{r, echo=FALSE}

model.plot <- 
  plot_model(model = model,
             sort.est = TRUE,
             transform = NULL,
             title = "",
             ci.lvl = .95,
             ci.style = "whisker",
             dot.size = 3,
             line.size = 1.2,
  ) +
  theme_classic(base_size = 12) +
  geom_hline(yintercept = 0, lty = "dashed") +
  ylab("Effect size") + xlab("Model parameter") +
  ggtitle(label = "P ~ Infection_binomial + Sex + Age + Species") 
#model.plot
```

```{r, echo=FALSE, eval = F}
## model predictions
(df.pred <- data.frame(
  Infection_binomial = rep(as.factor(0:1), 2),
  Species = rep(c("Milvus milvus"), each = 4),
  Sex = rep(c(rep("Female", 2), rep("Male", 2)),1),
  Age = 0))

fitted.values <- predict(model, df.pred, se.fit = T, interval = "confidence")
means <- fitted.values$fit[,1]
se <- fitted.values$se.fit
df.pred <- cbind(df.pred, means, se)

model.summary <- summary(model)

summary.table <-
  rbind(summary.table, data.frame(
    param = "P",
    Mean.0 = mean(df.pred$means[df.pred$Infection_binomial == 0]),
    SE.0 = mean(df.pred$se[df.pred$Infection_binomial == 0]),
    Mean.1 = mean(df.pred$means[df.pred$Infection_binomial == 1]),
    SE.1 = mean(df.pred$se[df.pred$Infection_binomial == 1]),
    t = model.summary$coefficients[2,3],
    p = model.summary$coefficients[2,4])
  )
```

```{r, echo=FALSE, eval=F}
write.csv(summary.table, file = "data/means.per.parameter.milvus.csv")
```
